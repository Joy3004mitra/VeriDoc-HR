@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>Square Payment</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Favicon
    ============================================ -->
    <link rel="shortcut icon" type="image/x-icon" href="~/Content/Images/favicon-square.png" />
    <!-- Fonts  -->
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap" rel="stylesheet" />

    @*@Styles.Render("~/Content/css/bootstrap.min.css")
        @Styles.Render("~/Content/css/pay-font-awesome.min.css")
        @Styles.Render("~/Content/css/mysqpaymentform.css")*@


    <link rel="stylesheet" href="~/Content/main-assets/css/bootstrap.min.css">
    <link rel="stylesheet" href="~/Content/main-assets/css/mysqpaymentform.css">
    <link rel="stylesheet" href="~/Content/main-assets/css/pay-font-awesome.min.css" />"
    <script type="text/javascript" src="https://js.squareupsandbox.com/v2/paymentform"></script>

   
</head>
<body class="home-1">
    <div class="main-area">
        <div class="pay-link-header">
            VERIDOC GLOBAL PTY LTD
        </div>

        <div class="pay-page">
            <div class="right-col">
                <section class="pay-page-content col-card">
                    <div class="card-header">
                        <div class="pay-page-info">
                            <h3 class="soc-product-title">@ViewBag.PlanName</h3>
                            <input type="hidden" id="hfPlanName" value="@ViewBag.PlanName" />
                            <input type="hidden" id="hfPlanPriceAU" value="@ViewBag.PlanPriceAU" />
                            <hr />
                            <h3 class="soc-product-price">
                                <span class="price">AU$@ViewBag.PlanPriceAU </span><span class="cadence">/ month</span>
                            </h3>
                            <p class="pay-link-description description">For US$@ViewBag.PlanPrice you will get 10 certificates added to your balance each month, unused certificates roll over to the following month.</p>
                        </div>
                    </div>

                    <div class="form-section">
                        <div class="pay-link-form">
                            <div class="form-input">
                                <input type="hidden" id="hfCustomerId" value="@ViewBag.customerId" />
                                <input placeholder="Email" type="email" value="@ViewBag.customerEmail" readonly="readonly" />
                            </div>
                            <div class="form-input name-form-input">
                                <input placeholder="Full name" type="text" value="@ViewBag.customerName" readonly="readonly" />
                            </div>
                            <div id="form-container" class="mt-3">
                                <div id="sq-card"></div>


                                <hr class="form-footer-divider" style="margin-top: 24px; margin-bottom: 24px;">

                                <div class="form-button pay-button">
                                    <button type="button">
                                        <span id="sq-creditcard" class="buttoncopy" onclick="onGetCardNonce(event);">Pay<span class="pay-button-price"> AU$@ViewBag.PlanPriceAU monthly </span></span>
                                        <span class="buttonanimation hiddencontent">
                                            <svg id="loading-bar" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 40.55 30">
                                                <g>
                                                    <path id="loading-bar-left" class="st0" d="M5.31,28.02L5.31,28.02c-1.3,0-2.36-1.06-2.36-2.36V4.61c0-1.3,1.06-2.36,2.36-2.36h0
                                                c1.3,0,2.36,1.06,2.36,2.36v21.05C7.67,26.96,6.62,28.02,5.31,28.02z" />
                                                    <path id="loading-bar-middle" class="st0" d="M15.65,28.02L15.65,28.02c-1.3,0-2.36-1.06-2.36-2.36V4.61c0-1.3,1.06-2.36,2.36-2.36h0
                                                c1.3,0,2.36,1.06,2.36,2.36v21.05C18,26.96,16.95,28.02,15.65,28.02z" />
                                                    <path id="loading-bar-right" class="st0" d="M25.98,28.02L25.98,28.02c-1.3,0-2.36-1.06-2.36-2.36V4.61c0-1.3,1.06-2.36,2.36-2.36h0
                                        c1.3,0,2.36,1.06,2.36,2.36v21.05C28.34,26.96,27.28,28.02,25.98,28.02z" />
                                                    <path id="loading-bar-middle" class="st0" d="M36.31,28.02L36.31,28.02c-1.3,0-2.36-1.06-2.36-2.36V4.61c0-1.3,1.06-2.36,2.36-2.36h0
                                        c1.3,0,2.36,1.06,2.36,2.36v21.05C38.67,26.96,37.62,28.02,36.31,28.02z" />
                                                </g>
                                            </svg>
                                        </span>
                                    </button>
                                </div>
                            </div>
                            <div class="notice-section">
                                <p class="legal-notice">By subscribing, you agree to the Square Pay <a target="_blank" href="https://squareup.com/legal/general/ua">Terms of Service</a> and <a target="_blank" href="https://squareup.com/legal/general/privacy">Privacy Notice</a>. Your subscription will renew automatically every month. You may cancel at any time.</p>
                            </div>
                        </div>
                    </div>
                </section>
            </div>
        </div>
    </div>
    <!-- End main area -->

    <footer class="squarefooter">
        <svg class="sqlogo" viewBox="0 0 24 24">
            <path fill-rule="evenodd" clip-rule="evenodd" d="M0 4.8C0 4.0568 0 3.68519 0.0492466 3.37426C0.320333 1.66269 1.66269 0.320333 3.37426 0.0492466C3.68519 0 4.0568 0 4.8 0H19.2C19.9432 0 20.3148 0 20.6257 0.0492466C22.3373 0.320333 23.6797 1.66269 23.9508 3.37426C24 3.68519 24 4.0568 24 4.8V19.2C24 19.9432 24 20.3148 23.9508 20.6257C23.6797 22.3373 22.3373 23.6797 20.6257 23.9508C20.3148 24 19.9432 24 19.2 24H4.8C4.0568 24 3.68519 24 3.37426 23.9508C1.66269 23.6797 0.320333 22.3373 0.0492466 20.6257C0 20.3148 0 19.9432 0 19.2V4.8ZM4.8 5.93684C4.8 5.30898 5.30898 4.8 5.93684 4.8H18.0632C18.691 4.8 19.2 5.30898 19.2 5.93684V18.0632C19.2 18.691 18.691 19.2 18.0632 19.2H5.93684C5.30898 19.2 4.8 18.691 4.8 18.0632V5.93684ZM9.03115 9.43972C9 9.53557 9 9.65402 9 9.89091V14.1091C9 14.346 9 14.4644 9.03115 14.5603C9.09409 14.754 9.24598 14.9059 9.43972 14.9689C9.53557 15 9.65402 15 9.89091 15H14.1091C14.346 15 14.4644 15 14.5603 14.9689C14.754 14.9059 14.9059 14.754 14.9689 14.5603C15 14.4644 15 14.346 15 14.1091V9.89091C15 9.65402 15 9.53557 14.9689 9.43972C14.9059 9.24598 14.754 9.09409 14.5603 9.03115C14.4644 9 14.346 9 14.1091 9H9.89091C9.65402 9 9.53557 9 9.43972 9.03115C9.24598 9.09409 9.09409 9.24598 9.03115 9.43972Z"></path>
        </svg>
        <!-- eslint-enable max-len -->
        <p>
            Secure checkout powered by Square
        </p>
    </footer>
    <script src="~/Content/main-assets/js/jquery/jquery-2.2.4.min.js"></script>
    <script src="~/Content/main-assets/js/bootstrap/bootstrap.min.js"></script>
    <script src="~/Content/main-assets/js/popper.min.js"></script>


    @*@Scripts.Render("~/Content/js/jquery-2.2.4.min.js")
        @Scripts.Render("~/Content/js/vendor/bootstrap.min.js")
        @Scripts.Render("~/Content/js/popper.min.js")*@

    <script type="text/javascript" language="javascript">
        function disablePayButton(isDisable) {
            if (isDisable) {
                $(".buttoncopy").addClass("hiddencontent");
                $(".buttonanimation ").removeClass("hiddencontent");
                $(".form-button.pay-button button").attr('disabled', 'disabled');
            }
            else {
                $(".buttonanimation").addClass("hiddencontent");
                $(".buttoncopy ").removeClass("hiddencontent");
                $(".form-button.pay-button button").attr('disabled', false);
            }
        }

        $(".form-button.pay-button button").click(function () {
            disablePayButton(true);
        });

        function initCardonFile(customerId, cardNonce) {
            var data = {
                customerId: customerId,
                cardNonce: cardNonce,
                planName: $("#hfPlanName").val(),
                planPriceAU: $("#hfPlanPriceAU").val()
            };
            $.ajax({
                url: "/Payment/sqAddCardonFile",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify(data),
                success: function (data) {
                    if (!data.error)
                        window.location.href = "/Payment/Success";
                    else
                        alert(data.error);
                },
                error: function (err) {
                    console.error(err);
                }
            });
        }

        // Create and initialize a payment form object
        const paymentForm = new SqPaymentForm({
            // Initialize the payment form elements

            applicationId: "sandbox-sq0idb-t082C39LYYWugu__vTaDxg",
            autoBuild: false,
            // Initialize the credit card placeholders
            card: {
                elementId: 'sq-card'
            },
            // SqPaymentForm callback functions
            callbacks: {
                paymentFormLoaded: function () {
                    paymentForm.focus("card");
                },
                /*
                * callback function: cardNonceResponseReceived
                * Triggered when: SqPaymentForm completes a card nonce request
                */
                cardNonceResponseReceived: function (errors, nonce, cardData) {
                    if (errors) {
                        // Log errors from nonce generation to the browser developer console.
                        console.error('Encountered errors:');
                        errors.forEach(function (error) {
                            console.error('  ' + error.message);
                        });
                        disablePayButton(false);
                        alert('Encountered errors, check browser developer console for more details');
                        return;
                    }

                    console.log(`The generated nonce is:\n${nonce}`);
                    initCardonFile($("#hfCustomerId").val(), nonce);
                }
            }
        });

        paymentForm.build();

        // onGetCardNonce is triggered when the "Pay $1.00" button is clicked
        function onGetCardNonce(event) {
            // Don't submit the form until SqPaymentForm returns with a nonce
            event.preventDefault();
            // Request a nonce from the SqPaymentForm object
            paymentForm.requestCardNonce();
        }

    </script>

</body>
</html>
